from shapely import geometry, wkt
import geopandas as gpd 
projection = '3413'

aoi_polar = 'POLYGON((-122530.8946800709 -804829.1816504888, 58584.52742899807 -684411.6256267565, 193689.190096267 -654941.4047940436, 395945.9821889399 -770798.1341841035, 447949.633211383 -746687.7765100151, 529950.3945635742 -765011.7404356601, 527387.5021544157 -996957.7075015747, 771520.3415511835 -1445232.730785041, 749299.089487767 -1705567.740974196, 854422.597101031 -1918451.776507847, 863409.5128539347 -2000171.452680239, 767956.5304289587 -2211507.711633767, 582188.7441462318 -2373198.078505974, 380100.6834204275 -2701101.939223708, 325910.9073513008 -2684422.010780717, 246020.2864406212 -2762647.851723505, 248516.2916427735 -2905132.328994351, 173903.3323740227 -3013195.51568681, 172757.3407612883 -3137742.877069402, 143639.3994968857 -3284227.064356036, 100456.7314621407 -3362966.506822938, -3052.157712615277 -3350109.328676191, -204996.7015322061 -3231329.624809708, -279643.8187164029 -3068259.112314412, -364924.0241748905 -2839711.249182686, -356501.6070155338 -2750058.553360153, -398881.1688176729 -2651184.738559582, -406484.5333350517 -2482633.470719577, -356868.3235230458 -2290288.325830708, -393291.6386670935 -2186545.60348651, -382442.7125800091 -1601470.058853294, -409721.7893641168 -1487931.875813007, -571867.9171365914 -1440632.996896198, -620939.7578116545 -1390080.454657881, -642912.6786178964 -1212060.472044687, -614727.6808560205 -1130243.9392227, -577130.1415470454 -1097524.986326331, -446760.4285315409 -1072892.961074124, -422687.3985106602 -997696.0655459169, -396953.3685330221 -944813.238651685, -220396.5174233511 -824787.7645723475, -122530.8946800709 -804829.1816504888))'


aoi_gpd = gpd.GeoDataFrame(geometry=[wkt.loads(aoi_polar)], crs = "EPSG:3413")
grid = gpd.read_file("polar-50km.geojson")


print("Intersecting....")
toProcess=gpd.overlay(aoi_gpd, grid, how='intersection')

#Remove chunks that are too small to be processed

print("Removing Small Tiles....")
MIN_AREA = 0.1 * (50000 * 50000)
toProcess = toProcess[toProcess.geometry.to_crs('epsg:3413').area > MIN_AREA]

print("Exporting to Geojson")
toProcess.to_file("Greenland_50kmTiles.geojson", driver="GeoJSON")  

